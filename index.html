<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Study Helper</title>
    <link rel="stylesheet" href="style.css" />
    </head>
    <body>
    <div class="container">
        <h1>ğŸ§  ë‹¹ì‹ ì˜ ê³µë¶€ë¥¼ ë„ì™€ë“œë¦½ë‹ˆë‹¤!</h1>

        <div>
        <img src="./image/ë¦¬ë½ì¿ ë§ˆ.png" alt="ê·€ì—¬ìš´ ì´ë¯¸ì§€" />
        </div>

        <label for="question">ì§ˆë¬¸</label>
        <textarea id="question" placeholder="ì˜ˆ: êµ¬ì¡°ì²´ê°€ ë­”ê°€ìš”?" rows="3"></textarea>

        <label for="difficulty">ì–´ë ¤ìš´ ì </label>
        <input type="text" id="difficulty" placeholder="ì˜ˆ: ì¤‘ì²© êµ¬ì¡°ì²´ê°€ í—·ê°ˆë ¤ìš”" />

        <label for="understandingLevel">ì´í•´ë„</label>
        <select id="understandingLevel">
        <option value="1">1 - ê±°ì˜ ëª°ë¼ìš”</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5 - ê±°ì˜ ë‹¤ ì•Œì•„ìš”</option>
        </select>

        <button onclick="sendToAPI()">ì§ˆë¬¸ ë³´ë‚´ê¸°</button>
    </div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div class="result-wrapper">
        <h2>ğŸ“˜ AIì˜ ë‹µë³€</h2>
        <div id="result" class="styled-result">
        ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>

    <script>
    function formatResultText(text) {
        const lines = text.split("\n");

        return lines.map((line, idx) => {
            const trimmed = line.trim();

            // **ë¬¸ì œ 1**, **1. ì œëª©** â†’ heading ì²˜ë¦¬
            if (/^\*\*.*\*\*$/.test(trimmed)) {
            const cleanLine = trimmed.replace(/^\*\*(.*?)\*\*$/, '$1');
            return `<div class="heading">${cleanLine}</div>`;
            }
        // ìˆ«ì.ìˆ«ì ì„œë¸Œ íƒ€ì´í‹€ ex) 2.1 ìœ ì‚¬ ë¬¸ì œ
            if (/^\d+\.\d+\s+.+/.test(trimmed)) {
            return `<div class="subheading">${trimmed}</div>`;
            }
            // Markdown # í—¤ë”© ì²˜ë¦¬
            if (/^#{1,6}\s+.+/.test(trimmed)) {
            const cleanLine = trimmed.replace(/^#{1,6}\s+/, '');
            return `<div class="heading">${cleanLine}</div>`;
            }

            // ìˆ«ì. + ì§§ì€ í•œ ë‹¨ì–´ ê°™ì€ ê²½ìš° â†’ detail ì²˜ë¦¬
            if (/^\d+\.\s+\S+$/.test(trimmed)) {
            return `<div class="detail">${trimmed}</div>`;
            }

            // ìˆ«ì. + ë‹¤ìŒ ì¤„ì´ ë¹„ì–´ ìˆìœ¼ë©´ heading (ì§„ì§œ í° ì œëª©)
            if (/^\d+\..+$/.test(trimmed)) {
            const nextLine = lines[idx + 1]?.trim();
            if (!nextLine) return `<div class="heading">${trimmed}</div>`;
            }

            // ì¼ë°˜ ì¤„ â†’ detail ì²˜ë¦¬
            return `<div class="detail">${line}</div>`;
        }).join("");
    }

    if (req.method === "OPTIONS") {
        return res.status(200).end();
    }

    const { question, difficulty, understandingLevel } = req.body;

    if(!question || !difficulty || !understandingLevel){
        return res.status(400).json({error:"questionê³¼ difficultyì™€ understandingLevelì´ í•„ìš”í•©ë‹ˆë‹¤."});
    }









        async function sendToAPI() {
        const question = document.getElementById("question").value;
        const difficulty = document.getElementById("difficulty").value;
        const understandingLevel = document.getElementById("understandingLevel").value;
        const resultBox = document.getElementById("result");

        if (!question || !difficulty || !understandingLevel) {
            resultBox.innerHTML = "<div class='heading'>âš ï¸ ëª¨ë“  ì…ë ¥ê°’ì„ ì±„ì›Œì£¼ì„¸ìš”.</div>";
            return;
        }

        resultBox.innerHTML = "â³ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...";

        try {
            const res = await fetch("https://assign2-one.vercel.app/api/duksungAI", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question, difficulty, understandingLevel })
            });

            const data = await res.json();

            if (data.answer) {
            resultBox.innerHTML = formatResultText(data.answer);
            } else {
            resultBox.innerHTML = `<div class="heading">âš ï¸ ì˜¤ë¥˜</div><div class="detail">${data.error || "ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤."}</div>`;
            }
        } catch (err) {
            resultBox.innerHTML = `<div class="heading">âŒ ìš”ì²­ ì‹¤íŒ¨</div><div class="detail">${err.message}</div>`;
        }
        }
    </script>
</body>
</html>



